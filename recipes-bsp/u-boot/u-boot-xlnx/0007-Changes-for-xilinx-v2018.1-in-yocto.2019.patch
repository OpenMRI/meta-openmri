From 7d430151307a4b808096668a0f4358c00faaff19 Mon Sep 17 00:00:00 2001
From: Danny Park <danny.park@outlook.com>
Date: Fri, 26 Jul 2019 03:53:24 -0400
Subject: [PATCH 7/7] Changes for xilinx-v2018.1 in yocto.

---
 common/main.c                     |  2 +-
 configs/zynq_red_pitaya_defconfig | 55 ++++++++++++++++++++++++-------
 2 files changed, 44 insertions(+), 13 deletions(-)

diff --git a/common/main.c b/common/main.c
index 316c78de73..d800063ed0 100644
--- a/common/main.c
+++ b/common/main.c
@@ -58,7 +58,7 @@ void main_loop(void)
 	if (cli_process_fdt(&s))
 		cli_secure_boot_cmd(s);
 
-	setenv("sdboot", "echo Running script from SD... && mmcinfo && fatload mmc 0 0x2000000 u-boot.scr && source 0x2000000");
+	env_set("sdboot", "echo Running script from SD... && mmcinfo && fatload mmc 0 0x2000000 u-boot.scr && source 0x2000000");
 
 	autoboot_command(s);
 
diff --git a/configs/zynq_red_pitaya_defconfig b/configs/zynq_red_pitaya_defconfig
index 7a46c92917..81119f8a24 100644
--- a/configs/zynq_red_pitaya_defconfig
+++ b/configs/zynq_red_pitaya_defconfig
@@ -1,21 +1,36 @@
 CONFIG_ARM=y
 CONFIG_SYS_CONFIG_NAME="zynq_red_pitaya"
 CONFIG_ARCH_ZYNQ=y
-CONFIG_SYS_MALLOC_F_LEN=0x800
 CONFIG_SYS_TEXT_BASE=0x4000000
+CONFIG_SYS_MALLOC_F_LEN=0x800
+CONFIG_IDENT_STRING=" Zynq Red Pitaya OpenMRI"
+CONFIG_SPL_STACK_R_ADDR=0x200000
 CONFIG_DEFAULT_DEVICE_TREE="zynq-red-pitaya"
-# CONFIG_FIT=y
-# CONFIG_FIT_VERBOSE=y
-# CONFIG_FIT_SIGNATURE is not set
 CONFIG_SYS_NO_FLASH=y
+#CONFIG_DEBUG_UART=y
+CONFIG_DISTRO_DEFAULTS=y
+#CONFIG_FIT=y
+#CONFIG_FIT_SIGNATURE=y
+#CONFIG_FIT_VERBOSE=y
+CONFIG_BOOTCOMMAND="run $modeboot || run distro_bootcmd"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_SPL=y
-#CONFIG_SPL_OS_BOOT=y
-CONFIG_HUSH_PARSER=y
+CONFIG_SPL_STACK_R=y
+CONFIG_SPL_OS_BOOT=y
 CONFIG_SYS_PROMPT="Zynq> "
-# CONFIG_CMD_IMLS is not set
+#CONFIG_CMD_THOR_DOWNLOAD=y
+CONFIG_CMD_EEPROM=y
+CONFIG_CMD_MEMTEST=y
+CONFIG_CMD_DFU=y
 # CONFIG_CMD_FLASH is not set
+CONFIG_CMD_FPGA_LOADBP=y
+CONFIG_CMD_FPGA_LOADFS=y
+CONFIG_CMD_FPGA_LOADMK=y
+CONFIG_CMD_FPGA_LOADP=y
+CONFIG_CMD_GPIO=y
+CONFIG_CMD_I2C=y
 CONFIG_CMD_MMC=y
+CONFIG_CMD_SF=y
 CONFIG_CMD_I2C=y
 CONFIG_CMD_USB=y
 CONFIG_CMD_DFU=y
@@ -32,17 +47,33 @@ CONFIG_CMD_EXT4_WRITE=y
 CONFIG_CMD_FAT=y
 CONFIG_CMD_FS_GENERIC=y
 CONFIG_OF_EMBED=y
-# CONFIG_OF_CONTROL is not set
+CONFIG_ENV_IS_IN_SPI_FLASH=y
 # CONFIG_NET_RANDOM_ETHADDR=y
 CONFIG_SPL_DM_SEQ_ALIAS=y
 CONFIG_DFU_MMC=y
 CONFIG_DFU_RAM=y
+CONFIG_FPGA_XILINX=y
 CONFIG_DM_GPIO=y
 CONFIG_DM_MMC=y
 CONFIG_ZYNQ_SDHCI=y
 CONFIG_MMC_SDHCI=y
-CONFIG_DM_ETH=y
+CONFIG_MMC_SDHCI_ZYNQ=y
+CONFIG_SPI_FLASH=y
+CONFIG_SPI_FLASH_BAR=y
+CONFIG_SF_DUAL_FLASH=y
+CONFIG_SPI_FLASH_ISSI=y
+CONFIG_SPI_FLASH_MACRONIX=y
+CONFIG_SPI_FLASH_SPANSION=y
+CONFIG_SPI_FLASH_STMICRO=y
+CONFIG_SPI_FLASH_WINBOND=y
+CONFIG_PHY_MARVELL=y
+CONFIG_PHY_REALTEK=y
+CONFIG_PHY_XILINX=y
 CONFIG_ZYNQ_GEM=y
+CONFIG_DEBUG_UART_ZYNQ=y
+CONFIG_DEBUG_UART_BASE=0xe0001000
+CONFIG_DEBUG_UART_CLOCK=50000000
+CONFIG_ZYNQ_SERIAL=y
 # CONFIG_ZYNQ_QSPI=y
 CONFIG_USB=y
 CONFIG_USB_EHCI_HCD=y
@@ -50,8 +81,8 @@ CONFIG_USB_ULPI_VIEWPORT=y
 CONFIG_USB_ULPI=y
 CONFIG_USB_STORAGE=y
 CONFIG_USB_GADGET=y
+CONFIG_USB_GADGET_MANUFACTURER="Xilinx"
+CONFIG_USB_GADGET_VENDOR_NUM=0x03fd
+CONFIG_USB_GADGET_PRODUCT_NUM=0x0300
 CONFIG_CI_UDC=y
 CONFIG_USB_GADGET_DOWNLOAD=y
-CONFIG_G_DNL_MANUFACTURER="Xilinx"
-CONFIG_G_DNL_VENDOR_NUM=0x03fd
-CONFIG_G_DNL_PRODUCT_NUM=0x0300
-- 
2.17.1

